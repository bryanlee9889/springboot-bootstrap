<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.averagejoedev.mappers.MapperToken">

    <select id="findOne" resultType="Token">
        SELECT  *
        FROM    tokens
        <where>
            <if test="tableRef != null">
                AND     table_ref   = #{tableRef}
            </if>
            <if test="rowRef != null">
                AND     row_ref     = #{rowRef}
            </if>
            <if test="type != null">
                AND     type        = #{type}
            </if>
            <if test="token != null">
                AND     token       = #{token}
            </if>
            <if test="uuid != null">
                AND     uuid        = #{uuid}
            </if>
            <if test="statuses != null">
                AND     status      IN
                <foreach collection="statuses" index="index" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
        </where>
        ORDER BY ${orders} ${direction}
        LIMIT 1;
    </select>

    <insert id="insert">
        INSERT INTO tokens
        (
            created_date,
            expired_date,
            type,
            token,
            table_ref,
            row_ref,
            uuid
        )
        VALUES
        (
            current_timestamp(),
            date_add(current_timestamp(), INTERVAL 60 SECOND),
            #{type},
            #{token},
            #{tableRef},
            #{rowRef},
            #{uuid}
        )
    </insert>

    <update id="update">
        UPDATE tokens
        <set>
            <if test="status != null">
                status  = #{status}
            </if>
        </set>
        <where>
            <if test="id != null">
                    id      = #{id}
            </if>
            <if test="token != null">
                AND token   = #{token}
            </if>
            <if test="type != null">
                AND type    = #{type}
            </if>
            <if test="tableRef != null">
                AND table_ref=#{tableRef}
            </if>
            <if test="rowRef != null">
                AND row_ref = #{rowRef}
            </if>
            <if test="uuid != null">
                AND uuid    = #{uuid}
            </if>
        </where>
    </update>

    <delete id="delete">
        DELETE FROM tokens
        <where>
            <if test="id != null">
                    id          = #{id}
            </if>
            <if test="type != null">
                AND type        = #{type}
            </if>
            <if test="tableRef != null">
                AND table_ref   = #{tableRef}
            </if>
            <if test="rowRef != null">
                AND row_ref     = #{rowRef}
            </if>
            <if test="status != null">
                AND status      = #{status}
            </if>
            <if test="uuid != null">
                AND uuid        = #{uuid}
            </if>
        </where>
    </delete>

</mapper>