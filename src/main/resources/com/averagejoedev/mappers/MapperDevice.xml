<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.averagejoedev.mappers.MapperDevice">

    <select id="find" resultType="Device">
        SELECT  *
        FROM    devices
        <where>
            <if test="id != null">
                id          = #{id}
            </if>
            <if test="userFk != null">
                AND     user_fk     = #{userFk}
            </if>
            <if test="uuid != null">
                AND     uuid        = #{uuid}
            </if>
            <if test="deviceToken != null">
                AND     device_token= #{deviceToken}
            </if>
            <if test="status != null">
                AND     status      IN
                <foreach collection="status" index="index" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
        </where>
        ORDER BY        ${orders} ${direction}
        LIMIT           ${pageIndex*pageSize},${pageSize}
    </select>

    <select id="count" resultType="int">
        SELECT  count(*)
        FROM    devices
        <where>
            <if test="id != null">
                id          = #{id}
            </if>
            <if test="userFk != null">
                AND     user_fk     = #{userFk}
            </if>
            <if test="uuid != null">
                AND     uuid        = #{uuid}
            </if>
            <if test="deviceToken != null">
                AND     device_token= #{deviceToken}
            </if>
            <if test="status != null">
                AND     status      IN
                <foreach collection="status" index="index" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

    <select id="findOne" resultType="Device">
        SELECT  *
        FROM    devices
        <where>
            <if test="id != null">
                        id          = #{id}
            </if>
            <if test="userFk != null">
                AND     user_fk     = #{userFk}
            </if>
            <if test="uuid != null">
                AND     uuid        = #{uuid}
            </if>
            <if test="deviceToken != null">
                AND     device_token= #{deviceToken}
            </if>
            <if test="status != null">
                AND     status      IN
                <foreach collection="status" index="index" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
        </where>
        ORDER BY ${orders} ${direction}
        LIMIT 1
    </select>

    <insert id="insert">
        INSERT IGNORE INTO devices
        (
            created_date,
            user_fk,
            uuid,
            device_token
        )
        VALUES
        (
            current_timestamp(),
            #{userFk},
            #{uuid},
            #{deviceToken}
        )
    </insert>

    <update id="update">
        UPDATE devices
        <set>
            <if test="status != null">
                status  = #{status}
            </if>
        </set>
        <where>
            <if test="id != null">
                id          = #{id}
            </if>
            <if test="userFk != null">
                AND     user_fk     = #{userFk}
            </if>
            <if test="uuid != null">
                AND     uuid        = #{uuid}
            </if>
            <if test="deviceToken != null">
                AND     device_token= #{deviceToken}
            </if>
            <if test="status != null">
                AND     status      IN
                <foreach collection="status" index="index" item="item" open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
        </where>
    </update>

    <delete id="delete">
        DELETE FROM devices
        <where>

        </where>
    </delete>


</mapper>